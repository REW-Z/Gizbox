# Gizbox 文档  


## 类型    

基础类型：`void`、`bool`、`char`、`int`、`long`、`float`、`double`。  
引用类型：`Core::Object`及其派生类。    
特殊引用类型：`string`。  

## 类和继承  

- 只允许单继承。  
- 所有函数都是虚函数。  
- 所有成员都是公有的。  
- 类中只能有非静态成员。    



## 全局作用域和顶层语句    

支持顶层语句。  

显式定义的顶层变量视作全局变量，存储在静态数据区。顶层临时变量视为局部变量。     

## 命名空间  

命名空间和全局变量名、类名之间使用`::`分隔，允许嵌套。    
命名空间导入`using XXX`在`import`语句之后、顶级语句之前。   


## 在Windows64平台的栈帧结构    

```  
高地址
+------------------+
| 参数5, 6, 7...    | <- 超出4个参数的部分
+------------------+
| Shadow Space     | <- 32字节（调用者分配）
| (4个8字节槽位)    |
+------------------+
| 返回地址          | <- call指令推入
+------------------+
| 保存的RBP         | <- 被调用者保存
+------------------+
| 保存的其他非易失性 | <- 被调用者保存
| 寄存器            |
+------------------+
| 局部变量          | <- 编译器分配
+------------------+
| 寄存器溢出槽位     | <- 编译器管理
+------------------+
| 对齐填充          | <- 保持16字节对齐
+------------------+ <- RSP指向这里
低地址
```


## 开发日志  

**Prospects**  

操作符重载(代码生成层面 or 解释器层面)    
值类型结构体（需要脚本引擎模拟内存）      
模式匹配（Pattern Matching）  
管道操作符（Pipeline Operator）
解构赋值（Destructuring Assignment）
内置并发支持（Built-in Concurrency Support）
可选链（Optional Chaining）
函数式编程(惰性求值（Lazy Evaluation）、无副作用函数)
函数头等公民  
元编程和宏（类似Lisp和Rust的宏）  
响应式编程原生支持  
借鉴（Haskell、LISP、Prolog、Rust）  


**泛型开发**  

使用类型擦除或者模板实现泛型。  

**多线程开发**  

无栈协程实现。  

**优化**    

优化外部函数调用效率。使用CreateDelegate？  
使用哈希表优化LALR生成算法。  

**所有权开发**    

使用own和borrow关键字实现所有权系统。  


**字符串临时值优化方法**  

1.手动释放（C语言）  
2.栈分配（自动对象）（C++）  
3.作用域内存池。  
4.编译器优化RVO。  
5.所有权（目前最优解）。    

**Gizbox TODO**   

尝试用RUST的所有权系统管理字符串这对象引用类型。    