import <"core">  
import <"stdlib">  

using Core;  
using Console;
using Collections;

int globalVar1 = 444;
float globalVar2 = 444.0f;

// ----------------- 全局变量读写测试 ------------------

void test_global_var()
{
	int result = globalVar1 + (int)globalVar2;
	Console::PrintLn("result:" + (string)result);
}

// ----------------- 寄存器溢出测试 ------------------

void test_reg_alloc()
{
	int v1 = 2;
	int v2 = 2;
	int v3 = 2;
	int v4 = 2;
	int v5 = 2;
	int v6 = 2;
	int v7 = 2;
	int v8 = 2;
	
	
	int rs = v1 + v8;
	rs += v2 + v7;
	rs += v3 + v6;
	rs += v4 + v5;
	Console::PrintLn("test!" + (string)rs);
}

// ----------------- 调用测试 ------------------

int sum(int x, int y, int z)
{
	return x + y - z;
}

void test_call()
{
	int num1 = 1000;
	int num2 = 200;
	int num3 = 100;
	int num4 = sum(num1, num2, num3);
	Console::PrintLn("Calc:");
	Console::PrintLn((string)num4);
}

// ----------------- SizeOf ------------------

void test_sizeof()
{
	int sizeofint = sizeof(int);
	Console::PrintLn("sizeof(int):" + (string)sizeofint);
}

// ----------------- Dic ------------------
class OOO{}
void test_dic()
{
	HashMap<int, int> dict = new HashMap<int, int>();
	dict.Add(1, 10);
	int result = dict.Get(1);
	Console::PrintLn("Dic1 result:" + (string)result);

	var dict2 = new HashMap<string, string>();
	dict2.Add("key", "value");
	string result2 = dict2.Get("key");
	Console::PrintLn("Dic2 result:" + result2);

	var dict3 = new HashMap<OOO, int>();
	OOO o = new OOO();
	dict3.Add(o, 123);
	int result3 = dict3.Get(o);
	Console::PrintLn("OOO addr :" + (string)(hashof(o)));
	Console::PrintLn("Dic3 result:" + (string)result3);
}

// ----------------- 位运算 -----------------
void test_bitwise()
{
	int a = 5; // 0101
	int b = 3; // 0011
	int andResult = a & b; // 0001 -> 1
	int orResult =  a | b;  // 0111 -> 7
	int notResult = ~a;    // 1010 (取反) -> -6  
	Console::PrintLn("Bitwise AND: " + (string)andResult);
	Console::PrintLn("Bitwise OR: " + (string)orResult);
	Console::PrintLn("Bitwise NOT: " + (string)notResult);
}

// ----------------- RTTI ------------------
void test_rtti()
{
	var t1 = typeof(Core::Object);
	var t2 = typeof(Core::Int);
	var t3 = typeof(int);
	int v1 = 111;
	Core::Int v2 = null;

	var t4 = gettype(v1);
	var t5 = gettype(v2);

	Console::PrintLn("Type of Core::Object: " + t1.name);
	Console::PrintLn("Type of Core::Int: " + t2.name);
	Console::PrintLn("Type of int: " + t3.name);
	Console::PrintLn("GetType v1: " + t4.name);
	Console::PrintLn("GetType v2: " + t5.name);
}

// ----------------- IO --------------------
void test_fileio()
{
	var path = "C:\\Users\\saus\\Desktop\\test_file.txt";
	IO::FileWriteAllText(path, "Hello World!");
	Console::PrintLn("File written:" + path);
}

// ----------------- Main ------------------
void main()
{
	test_global_var();
	test_reg_alloc();
	test_call();
	test_sizeof();
	test_dic();
	test_bitwise();
	test_rtti();
	test_fileio();

	Console::PrintLn("Test finished!");
	Console::ReadLn();
}